using System;
using Contests.Common;
using FluentAssertions;
using NUnit.Framework;

namespace Contests.Tasks.AdventOfCode2020
{
    public static class Task3
    {
        public static long CountTrees(string[] maze, int dx, int dy)
        {
            var x = 0;
            var y = 0;
            var treeCount = 0;
            while (y <= maze.Length - 1)
            {
                if (maze[y][x] == '#')
                {
                    maze[y] = maze[y].ReplacePosition(newChar: 'X', x);
                    treeCount++;
                }
                else
                {
                    maze[y] = maze[y].ReplacePosition(newChar: 'O', x);
                }

                x = (x + dx) % maze[0].Length;
                y += dy;
            }

            return treeCount;
        }
    }

    public class Task3Tests
    {
        [Test]
        public void TestExample()
        {
            var x = Assert(GetExamplePattern(), dx: 1, dy: 1, expectedTreeCount: 2);
            x *= Assert(GetExamplePattern(), dx: 3, dy: 1, expectedTreeCount: 7);
            x *= Assert(GetExamplePattern(), dx: 5, dy: 1, expectedTreeCount: 3);
            x *= Assert(GetExamplePattern(), dx: 7, dy: 1, expectedTreeCount: 4);
            x *= Assert(GetExamplePattern(), dx: 1, dy: 2, expectedTreeCount: 2);
            Console.WriteLine(x);
        }

        [Test]
        public void TestSimple()
        {
            Assert(GetSimplePattern(), dx: 1, dy: 1, expectedTreeCount: 2);
            Assert(GetSimplePattern(), dx: 1, dy: 2, expectedTreeCount: 1);
            Assert(GetSimplePattern(), dx: 2, dy: 1, expectedTreeCount: 2);
            Assert(GetSimplePattern(), dx: 2, dy: 2, expectedTreeCount: 1);
            Assert(GetSimplePattern(), dx: 1, dy: 3, expectedTreeCount: 0);
        }


        [Test]
        public void TestFullOfTrees()
        {
            Assert(GetFullOfTreesPatternEven(), dx: 1, dy: 1, expectedTreeCount: 2);
            Assert(GetFullOfTreesPatternEven(), dx: 1, dy: 2, expectedTreeCount: 1);
            Assert(GetFullOfTreesPatternOdd(), dx: 1, dy: 1, expectedTreeCount: 3);
            Assert(GetFullOfTreesPatternOdd(), dx: 1, dy: 2, expectedTreeCount: 2);
        }

        [Test]
        public void TestTask()
        {
            var x = Assert(GetTaskPattern(), dx: 1, dy: 1, expectedTreeCount: 79);
            x *= Assert(GetTaskPattern(), dx: 3, dy: 1, expectedTreeCount: 234);
            x *= Assert(GetTaskPattern(), dx: 5, dy: 1, expectedTreeCount: 72);
            x *= Assert(GetTaskPattern(), dx: 7, dy: 1, expectedTreeCount: 91);
            x *= Assert(GetTaskPattern(), dx: 1, dy: 2, expectedTreeCount: 48);
            Console.WriteLine(x);
        }

        private static long Assert(string[] maze, int dx, int dy, long expectedTreeCount)
        {
            var countTrees = Task3.CountTrees(maze, dx, dy);

            Console.WriteLine($"Maze for dx={dx} dy={dy}");
            foreach (var str in maze)
            {
                Console.WriteLine(str);
            }

            countTrees.Should().Be(expectedTreeCount, $"dx={dx} dy={dy}");
            return countTrees;
        }

        private static string[] GetExamplePattern()
        {
            return new[]
            {
                "..##.......",
                "#...#...#..",
                ".#....#..#.",
                "..#.#...#.#",
                ".#...##..#.",
                "..#.##.....",
                ".#.#.#....#",
                ".#........#",
                "#.##...#...",
                "#...##....#",
                ".#..#...#.#"
            };
        }

        private static string[] GetFullOfTreesPatternOdd()
        {
            return new[]
            {
                "#",
                "#",
                "#"
            };
        }

        private static string[] GetFullOfTreesPatternEven()
        {
            return new[]
            {
                "#",
                "#"
            };
        }

        private static string[] GetSimplePattern()
        {
            return new[]
            {
                ".#.#",
                ".##.",
                "####",
                "....",
                ".#.#"
            };
        }


        private static string[] GetTaskPattern()
        {
            return new[]
                {
                    ".......#..#....#...#...#......#", "..##..#...##.###.#..#.....#.#..",
                    "#..#.#....#......#..#.........#",
                    ".#..##...#........#....#..#..#.", "#.#.#....###...#........#.....#",
                    ".#...#.#.##.#.##...#.#.........",
                    "####......#.......###.##.#.....", "..#...........#...#.#.#........",
                    ".#.......#....###.####..#......",
                    "...##........#....##.......##..", ".###......##.#......##....#.#.#",
                    "........#.#......##...#......#.",
                    "#....##.#..#...#.......#.......", ".#..##........##.........#....#",
                    ".#..#..#...#....#.#......#.#...",
                    "..#.#......##.#.......#....##..", "......##......#.#..##.#..#...#.",
                    ".....##.......#.#....#.#.......",
                    "........#.....#.....#..###.#...", "#........#..#.....#...#.#.#..#.",
                    ".#..#.....#...#........#.....#.",
                    ".#.#.....#.....#...#...........", ".....#.#..#..#...#..#..#..##..#",
                    "##.#...#....#..#.##..#.....#.#.",
                    "#.......####......#..#.#....#..", "......#.#...####.........#.#..#",
                    ".#.........#..#.#...#..........",
                    "...#####.#....#.#..#......#.#.#", "##....#.###....##...##..#.....#",
                    "...........####.##.#....##.##..",
                    "#.#.#..........#.#..##.#.######", "##...#..#...........###..#....#",
                    ".#.#.#...##..........##.#...#..",
                    "...#.#........#..##...#....#...", "......#..#...#..##....#.......#",
                    ".#..#.......#..#......##....##.",
                    ".......#.......#........#..##..", "...#...#...#.##......#.##.#....",
                    ".........#.........#.#.#.##....",
                    "..#...................#....#..#", ".........#..#.....#.#...#....#.",
                    "#.#.#...#........#..###.#......",
                    "#.#.#.####......##...#...#....#", "#...........##..#.#.#....#..#..",
                    "........#..#.#...........##.#.#",
                    ".#.........#...........#..#....", "#............##.#..#....##...##",
                    ".#....##..#.#....#.......#..#..",
                    "..#.#...#.#......####.......#..", "...#.#.......###......#.....#..",
                    "#......#.......#.#...#.#..##...",
                    "...#.....#...##.#.....#.#......", "#.#.#............#..#......#..#",
                    "....#...#...##.##.##...##.#....",
                    "..##........#..#........#...##.", ".......#..#...#.........#.....#",
                    "...........#.#......#...#......",
                    "...##..##..##..###..#..#..#..#.", "#..##.......##..#....#....#.#..",
                    "#.#.##.#..##.....#....#.#......",
                    "....#..##......#.#..#....#....#", ".#.#.........##...#......##.##.",
                    "##...........#..#.....#.###....",
                    ".#.###........#...#....##..#...", "......##.....#.................",
                    ".#.##..#.#.......#......#.#.#..",
                    ".#...#....#.##..........##.##..", "#...##......####.#....#....#...",
                    ".#...#.##.#.#.....#...#........",
                    ".#................#.##.#.###...", "...#.#..#.#.....##.....##....#.",
                    "..##.#..#..##.....#....#...#.##",
                    "........###.##..#..###.....#..#", "..##.....#.......#.#...##......",
                    "#.#..###...##.###.##.#..#...#..",
                    "#..#..#.#...#....#...##.....#.#", "#..................#........#..",
                    "#.....#.......#.##....##....#..",
                    "...#.............#.....#...#...", "...#...#.##..##.....#........#.",
                    ".......#........##....###..##..",
                    ".#....#....#.#..#......#....#.#", "..........#..#.#.....##...#.##.",
                    ".#...##.#...........#.#.......#",
                    "..#.##.....#.###.#.............", "..#....###..........#.#.#......",
                    "#.....#.####..#.#......#..#.#.#",
                    "...#........#..#...............", ".###.#.##.....#.#...........#..",
                    "..#....#..#....#..##....#......",
                    "......#..#.....#.#.##.......#.#", "###..#...#.#..#....#..##.###..#",
                    ".#....##.###........##...##.#.#",
                    "........##..##.#....##..#....#.", "...#..#....#.#....#...#...##...",
                    "#.....#......#.##........#....#",
                    "....#....###.##...#.#.##....#..", "......#.##..#.#..........#...#.",
                    "...........#...#....##...#....#",
                    "......#.#.........#....#.#.#...", ".###..........#.###.##....#...#",
                    "...##.......#......#....#....#.",
                    "#..#...#.#..####...#......#..#.", "....##..#.#.........#..........",
                    ".##.###.##....##.####....#...#.",
                    "..##.......#........#...#..#...", "....#####..........###....#....",
                    ".#.#..#.#.#....#..#............",
                    "........#.....#....#.......##..", "...........##....##..##.....##.",
                    "..###........#.#.#..#....##...#",
                    ".....#...........##......#..#..", "...##........#.##.#......##..#.",
                    "##..#....#............##..#..#.",
                    ".#.....#...##.##..............#", "#..##........#...#...#......##.",
                    "......##.....#.......####.##..#",
                    "...#.#....#...#..#.............", "..#...#..##.###..#..#.......##.",
                    "##....###.......#...#..#.......",
                    "#..#.....###.....#.#.........#.", "#.#....#.............#...#.....",
                    "..#.#.##..........#.....##.#...",
                    ".....##......#..#..#.....#..#..", "##.#..#..#.##......###....#..#.",
                    "...#............##...#..##.....",
                    ".#..#....#.........#......#.##.", ".##.##...#..............#..#.##",
                    "...#....#...###...#...#....#..#",
                    "..#...#..####..#....#.#...##..#", "..............##.##.......##...",
                    "..##.#..##...........#.#.#...#.",
                    "..................##.####.###..", ".#...........#.......#......#..",
                    ".#.#.#...#....#.........##...##",
                    "....#..........#.#....#.#.....#", "..........#.#..........#.#.....",
                    "...........#.....#.#......#....",
                    "........#..#.#.#.#.............", "...###...##...##..####.##......",
                    ".#..#......###.....#...#.....#.",
                    ".........##............#.#.....", "#.#..#.#.#....###.#.#..#..#..##",
                    "..........#...#.##.#..#..#....#",
                    "#..#.......##....#..##........#", "##.#...#....##.............#...",
                    "....#........#......##..#..#.##",
                    ".................#.#.#.#.#.....", "...........#.#.....#.......#...",
                    "#.......#.......#............#.",
                    "....#...........#.#.##.....#..#", "#...#.....#....#..##...#.......",
                    "..#.....#.....#.##.##....#.....",
                    ".#.#..#...#..#..##.....##..#...", ".#.#....#.........####.........",
                    "#...#..####.....#...#..##......",
                    "..#...##.#.....#...#.....##....", ".#...#.....#.#.#......#.......#",
                    "..#.....##.#..#.#...##.........",
                    "##.#...#..#....#....#.##.##...#", ".#..#....#..##.#.......#..#....",
                    "...##.#......#...###.......#...",
                    "...#..#.........##.####........", "#.#..#..##...........#..#......",
                    ".#...#.#......#.#..........#...",
                    "...###...#.......#.....#.#...##", "..#....#.#.##..........##...#..",
                    ".....###.........#.....#..##..#",
                    ".......##.....#.#.....#.#..##..", ".#.#.###..##.......##...#......",
                    "......#.....#................##",
                    ".#......##..##.#.#...#...#...##", ".#...#......#.......#.#........",
                    ".#..........###...#..#...#.....",
                    ".........##.....#.#..#..#.#...#", "#...#...#.........#..#..#....#.",
                    "###.......#.#.....#....##......",
                    ".#..#......#..#...........#..#.", "..##....##..##...#......#......",
                    ".#........#....#...#....#.....#",
                    ".#.......#...#...#..##.#.#..#..", "#...#........#.##.....#.....#..",
                    "#..##.....#..........#...#...##",
                    "............#...............#..", ".#.##...#.....#.#..#..#..#.....",
                    ".#.#.#...#........#....#...##..",
                    "##......#.....#.###.#...#.#..#.", ".........##..#..#.#...#...#...#",
                    "#...#.#....#..#..#.....#.......",
                    ".......#.###...#.............#.", "..#.....#.#.#..###.#....#.....#",
                    "....#...#.#....#.#..........#..",
                    "..#......#.###.#.#..#.....#...#", "#............#..##...##......#.",
                    "#...........#..#....#.###..###.",
                    ".#.##.#.#.......#.............#", "..............#................",
                    "..#.#.....#.....#...#......#...",
                    ".#.#.#..#..#.#...........##....", ".....##.#......#..#.##....#....",
                    ".......##..#.#.#..#............",
                    "..#.....#.....#.###..#.....#.#.", "......##.....#..##.#...#.....#.",
                    "...#...#....#..#..#........#...",
                    "..#.##..#....#.........#.#..#..", "#....#.....###.....#......#....",
                    "##.....#..#..##.........#.##.##",
                    ".#.#....#.#..........#.........", ".##.#...#..#.......#.##...#....",
                    "...#...#.....#....#...#.#..#...",
                    ".....#....#.....#.....#.#......", "...........#.#.......#.......#.",
                    ".........##.###.##........#....",
                    "#..##.....#...#.#..............", ".#...#....##........#.#..#....#",
                    "..#...#........#...#..#.##.#..#",
                    "........#...#.....##.#.#....#.#", "#..#.......###.#....#.#.#......",
                    ".......#...##....#...#..##..#..",
                    ".....##........#.#.#..#....##..", ".#....#..#.#...........#......#",
                    "...##....#.##.....##.......#...",
                    ".##..#..#....#.#....#..#....##.", "..#....#.....###.......#..##..#",
                    "....#.......#....##..#....#..##",
                    "....#......##..#....#.#...#.#..", ".##.#......##..................",
                    "##.#....#........#..#..#...##.#",
                    ".......#..#.#...##.....#.#.....", "..##.#...........#.#.#..#.#.#..",
                    ".....#....#......#..#.......#..",
                    "#.#...#.####..##.......#..##...", "...#....#.....#.##.#..#.##..#..",
                    ".#.......#......##........##.#.",
                    ".......#.#...#..#...#..##.#....", ".#....#........#.#.....##..#..#",
                    "#..#.....#..#.............#...#",
                    "#...#....#..#...###..#...#.#...", ".#..#.....#..........#..##.####",
                    "#.#.#.#.##.#.#.....##.#........",
                    "...#....##....#...#..##.......#", "..##.##.#.#........#..........#",
                    "..###........###..#..........#.",
                    "...#......#..##.#........#..#..", "#.#.#..#........#..#..........#",
                    "...#........#..##.#...#.###....",
                    "##......#.####.#....#......#...", ".#..#......#................#..",
                    "#.#........#.#.....##.....##...",
                    "#...............#..#.......#.#.", ".##..#...........##..#..#.#....",
                    "#......#.#.......#.#.#.##..#.##",
                    ".....##.#..###.............##..", "....##.........#..#...#........",
                    ".....#.....#.#.#..#.#..........",
                    "#.........#....##.#.##.....#..#", ".#.........#......#.#.##.#.#...",
                    "##.........#.....#..#.#..#.##.#",
                    "....#......##...#.....#..#..###", "..#..............#...#..####...",
                    "#....#...##.#.......#...#..#...",
                    "#.......###.#.#.......#.......#", "...##....#.#...........#...###.",
                    "...........#..#.#.....#..##..#.",
                    "..#.........#..###..#.....#...#", "..#.#.....#.#.#...#.#.#......#.",
                    "........#.....#.#......##....##",
                    "##.#.#...#.#........#.....#...#", "........#....#...............#.",
                    "##.###......####...#####..#....",
                    "...##...#..#....#........#...#.", "...###.#..................##.#.",
                    "##.#.......###.......#...#.#...",
                    "....#..#.#...#...#....#.#.#..##", "....#...........#..#...........",
                    "#..#.#..#...#...#..#...........",
                    "...#...#.#....#..#....#........", "#....#.......#.##........#..#..",
                    ".....#...#..#................#.",
                    "#......#.......#..........##..#", ".#....#.#......#.#...#....##..#",
                    "...#.##...#......#.#...##...##.",
                    "..#...#..##...#...#....#.......", ".....#....#.#.#..........#.#...",
                    "...#...#..#....#..#.#..........",
                    "......#.#..........##.......#..", ".#...##.#.#...#..##..#...#.....",
                    "..#..#.........#........#.#.#..",
                    "#.#..##..#.....##......#.....#.", "#..#.....#.#....#...#.#....#.#.",
                    "......#........##.#..#...#.....",
                    "...#.##.#.#......#.#..##...#..#", "....#..###..#..#.....###....##.",
                    ".....#...#.#.....#..........#.#",
                    ".#...##..##.....#..#...#.#.#...", ".##.#......##...##..#...#.....#",
                    ".#.##....#...#.##.#.#...#.#...#",
                    "....#.#...#....###.#.....#.....", "#.....####................#..#.",
                    "....#.....#...#.#.......##.#...",
                    ".#...##.#...#..#...........#.#.", "..#####..#.#...#...##........#.",
                    "...#...##........#...#.#....###",
                    "........#.#.#..#.....#.......#.", "...#...#..##............##.....",
                    "#.#..###....###.#...#.#...##.##",
                    "..#.##...#......#..#.........##", ".##..#..#.....#..#.........#.#.",
                    ".#..#.#....#.##...#..#.##....##",
                    "..#...#.#...##.#.#...#...#....#", "#..........#.......##..##....#.",
                    "#...###.#......#....#.........#",
                    "#.....#...##.......##....##....", ".##.#..#.##......#.##....#..#..",
                    "............#.#....##.#..#....#",
                    ".#.........##.##...#....#.....#", "##....##..#..#....##...#.....##",
                    "...#.....#...........#.....##..",
                    "......#...#.........#.......#..", "............#...##.#.....#.#.#.",
                    ".#........##..........#.....#.#",
                    ".###.........#.....#.##...#....", ".##..#...##...#..#..#.##......."
                }
                ;
        }
    }
}